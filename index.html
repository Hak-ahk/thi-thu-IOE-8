<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bài Thi Thử IOE Lớp 8</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .word-block {
            user-select: none;
            cursor: pointer;
        }
        .word-block.disabled {
            opacity: 0.6;
            cursor: default;
        }
    </style>
</head>
<body class="bg-gray-50 font-sans antialiased text-gray-800">
    <div id="app-root" class="p-4 sm:p-8 flex justify-center items-start min-h-screen">
        <div class="w-full max-w-3xl bg-white rounded-xl shadow-2xl p-6 sm:p-8 md:p-10 border border-gray-100 min-h-[80vh]">
            <!-- Nội dung sẽ được render tại đây -->
        </div>
    </div>

    <script>
        // Dữ liệu câu hỏi được trích xuất từ Đề thi thử IOE 8.pdf
        const questions = [
            // --- Part 1: Rearrange Questions (44 questions) ---
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ["He's", 'not', 'fond of', 'studying Maths.'],
                correctAnswer: "He's not fond of studying Maths.",
                hint_vi: 'Cấu trúc "to be fond of + V-ing" (thích/mê cái gì).',
                rationale_vi: 'Cấu trúc: S + to be + not + fond of + V-ing/N. Câu này dùng thì Hiện tại đơn.',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['teacher?', 'is', 'your', 'Who'],
                correctAnswer: 'Who is your teacher?',
                hint_vi: 'Câu hỏi Wh-question đơn giản.',
                rationale_vi: 'Cấu trúc: Who + is + Noun?',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['a', 'well-trained dog', 'is very helpful', 'on the farm.'],
                correctAnswer: 'A well-trained dog is very helpful on the farm.',
                hint_vi: 'Chủ ngữ là "a well-trained dog" (một con chó được huấn luyện tốt).',
                rationale_vi: 'Cấu trúc: S + to be + adj + Nơi chốn.',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['Minority women', 'weave clothes', 'and', 'do housework.'],
                correctAnswer: 'Minority women weave clothes and do housework.',
                hint_vi: 'Nối hai hành động song song bằng liên từ "and".',
                rationale_vi: 'Cấu trúc: S + V1 + and + V2.',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['My friend', 'TV.', 'dislikes', 'watching'],
                correctAnswer: 'My friend dislikes watching TV.',
                hint_vi: 'Động từ "dislike" đi với V-ing.',
                rationale_vi: 'Cấu trúc: S + V + V-ing + N.',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['Stilt houses', 'high', 'posts.', 'stand on'],
                correctAnswer: 'Stilt houses stand on high posts.',
                hint_vi: 'Nhà sàn đứng trên cái gì?',
                rationale_vi: 'Cấu trúc: S + stand on + N.',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['My grandmothers', 'are', 'at home.', 'praying'],
                correctAnswer: 'My grandmothers are praying at home.',
                hint_vi: 'Hành động đang diễn ra (Hiện tại tiếp diễn).',
                rationale_vi: 'Cấu trúc Hiện tại tiếp diễn: S + are + V-ing + Nơi chốn.',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['My sisters', 'fond of', 'are', 'paper folding.'],
                correctAnswer: 'My sisters are fond of paper folding.',
                hint_vi: 'Cấu trúc "to be fond of + N".',
                rationale_vi: 'Cấu trúc: S + are + fond of + N.',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['She', 'loves', 'drawing', 'pictures.'],
                correctAnswer: 'She loves drawing pictures.',
                hint_vi: 'Động từ "love" đi với V-ing.',
                rationale_vi: 'Cấu trúc: S + V + V-ing + N.',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['My brothers', 'are not', 'playing sport.', 'fond of'],
                correctAnswer: 'My brothers are not fond of playing sport.',
                hint_vi: 'Cấu trúc phủ định "to be not fond of + V-ing".',
                rationale_vi: 'Cấu trúc: S + are not + fond of + V-ing.',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['People', 'use', 'to harvest.', 'a combine harvester'],
                correctAnswer: 'People use a combine harvester to harvest.',
                hint_vi: 'Mục đích của việc sử dụng máy gặt đập liên hợp là gì?',
                rationale_vi: 'Cấu trúc: S + use + N + to V (chỉ mục đích).',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['Jane', 'wanted', 'to connect with', 'the community.'],
                correctAnswer: 'Jane wanted to connect with the community.',
                hint_vi: 'Hành động trong quá khứ ("wanted").',
                rationale_vi: 'Cấu trúc: S + V2/ed + to V + N.',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['History', 'lessons', 'enjoyable.', 'are'],
                correctAnswer: 'History lessons are enjoyable.',
                hint_vi: 'Tính từ "enjoyable" (thú vị) mô tả các bài học Lịch sử.',
                rationale_vi: 'Cấu trúc: N + to be + adj.',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['ornamental trees.', 'saw flowers', 'and', 'They'],
                correctAnswer: 'They saw flowers and ornamental trees.',
                hint_vi: 'Hành động trong quá khứ ("saw").',
                rationale_vi: 'Cấu trúc: S + V2/ed + N1 + and + N2.',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['Mai', 'doing puzzles.', 'keen on', 'is'],
                correctAnswer: 'Mai is keen on doing puzzles.',
                hint_vi: 'Cấu trúc "to be keen on + V-ing" (thích/say mê cái gì).',
                rationale_vi: 'Cấu trúc: S + to be + keen on + V-ing.',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['Do', 'they', 'fancy', 'making cheesecake?'],
                correctAnswer: 'Do they fancy making cheesecake?',
                hint_vi: 'Động từ "fancy" đi với V-ing. Câu hỏi Hiện tại đơn.',
                rationale_vi: 'Cấu trúc: Do + S + fancy + V-ing + N?',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['The workers', 'than you.', 'earlier', 'arrived'],
                correctAnswer: 'The workers arrived earlier than you.',
                hint_vi: 'So sánh hơn với trạng từ ("earlier").',
                rationale_vi: 'Cấu trúc: S + V + trạng từ so sánh hơn + than + N.',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['museums.', 'I', 'love', 'visiting'],
                correctAnswer: 'I love visiting museums.',
                hint_vi: 'Động từ "love" đi với V-ing.',
                rationale_vi: 'Cấu trúc: S + V + V-ing + N.',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['update it.', "don't", 'I', 'often'],
                correctAnswer: "I don't often update it.",
                hint_vi: 'Trạng từ tần suất "often" đứng sau trợ động từ.',
                rationale_vi: 'Cấu trúc phủ định: S + don\'t + often + V nguyên mẫu + O.',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['Developing', 'an understanding', 'of local', 'traditions', 'is not easy.'],
                correctAnswer: 'Developing an understanding of local traditions is not easy.',
                hint_vi: 'Danh động từ làm chủ ngữ (Developing...).',
                rationale_vi: 'Cấu trúc: V-ing phrase (Developing an understanding...) + to be + adj.',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['The buffaloes', 'are drinking', 'slowly.', 'more', 'water'],
                correctAnswer: 'The buffaloes are drinking water more slowly.',
                hint_vi: 'So sánh hơn với trạng từ dài ("more slowly").',
                rationale_vi: 'Cấu trúc: S + V + N + more + trạng từ + ...',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['She thinks', 'dogs', 'than', 'cats.', 'are faster'],
                correctAnswer: 'She thinks dogs are faster than cats.',
                hint_vi: 'So sánh hơn với tính từ ngắn ("faster").',
                rationale_vi: 'Cấu trúc: S1 + V + S2 + to be + tính từ so sánh hơn + than + N.',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['She', 'logged in to', 'Youtube', 'to upload', 'the videos.'],
                correctAnswer: 'She logged in to Youtube to upload the videos.',
                hint_vi: 'Hành động trong quá khứ ("logged in") và mục đích ("to upload").',
                rationale_vi: 'Cấu trúc: S + V2/ed + Nơi chốn + to V (chỉ mục đích).',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['This activity', 'helps children', 'discover', 'the culture', 'of their community.'],
                correctAnswer: 'This activity helps children discover the culture of their community.',
                hint_vi: 'Cấu trúc "help + O + V nguyên mẫu".',
                rationale_vi: 'Cấu trúc: S + helps + N + V nguyên mẫu + O.',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['Do', 'they', 'admire', 'the view', 'from here?'],
                correctAnswer: 'Do they admire the view from here?',
                hint_vi: 'Câu hỏi Hiện tại đơn.',
                rationale_vi: 'Cấu trúc: Do + S + V nguyên mẫu + N + Nơi chốn?',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['Teenagers today', 'surf', 'internet', 'frequently', 'than', 'past.'],
                correctAnswer: 'Teenagers today surf the internet more frequently than in the past.',
                hint_vi: 'So sánh hơn với trạng từ dài ("more frequently") và thiếu mạo từ "the" cho "internet" và cụm "in the past".',
                rationale_vi: 'Cấu trúc: S + V + more + trạng từ dài + than + in the past. (Đã bổ sung "the" và "in the").',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['The fields', 'look', 'greener', 'if', 'it', 'rain', 'tomorrow.'],
                correctAnswer: 'The fields look greener if it rains tomorrow.',
                hint_vi: 'Câu điều kiện loại 1 (If + Hiện tại đơn, Tương lai đơn/Hiện tại đơn).',
                rationale_vi: 'Cấu trúc câu điều kiện loại 1: Mệnh đề kết quả (The fields look greener - Hiện tại đơn) + if + Mệnh đề điều kiện (it rains tomorrow - Hiện tại đơn).',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['They', 'like', 'playing', 'soccer.'],
                correctAnswer: 'They like playing soccer.',
                hint_vi: 'Động từ "like" đi với V-ing.',
                rationale_vi: 'Cấu trúc: S + like + V-ing + N.',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['My brothers', 'are not', 'playing sport.', 'fond of'],
                correctAnswer: 'My brothers are not fond of playing sport.',
                hint_vi: 'Lặp lại câu 10, cấu trúc "to be not fond of + V-ing".',
                rationale_vi: 'Cấu trúc: S + are not + fond of + V-ing.',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['People', 'use', 'to harvest.', 'a combine harvester'],
                correctAnswer: 'People use a combine harvester to harvest.',
                hint_vi: 'Lặp lại câu 11. Mục đích của việc sử dụng máy gặt đập liên hợp.',
                rationale_vi: 'Cấu trúc: S + use + N + to V (chỉ mục đích).',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['Jane', 'wanted', 'to connect with', 'the community.'],
                correctAnswer: 'Jane wanted to connect with the community.',
                hint_vi: 'Lặp lại câu 12. Hành động trong quá khứ ("wanted").',
                rationale_vi: 'Cấu trúc: S + V2/ed + to V + N.',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['History', 'lessons', 'enjoyable.', 'are'],
                correctAnswer: 'History lessons are enjoyable.',
                hint_vi: 'Lặp lại câu 13. Tính từ "enjoyable" mô tả các bài học Lịch sử.',
                rationale_vi: 'Cấu trúc: N + to be + adj.',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['ornamental trees.', 'saw flowers', 'and', 'They'],
                correctAnswer: 'They saw flowers and ornamental trees.',
                hint_vi: 'Lặp lại câu 14. Hành động trong quá khứ ("saw").',
                rationale_vi: 'Cấu trúc: S + V2/ed + N1 + and + N2.',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['Mai', 'doing puzzles.', 'keen on', 'is'],
                correctAnswer: 'Mai is keen on doing puzzles.',
                hint_vi: 'Lặp lại câu 15. Cấu trúc "to be keen on + V-ing".',
                rationale_vi: 'Cấu trúc: S + to be + keen on + V-ing.',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['Do', 'they', 'fancy', 'making cheesecake?'],
                correctAnswer: 'Do they fancy making cheesecake?',
                hint_vi: 'Lặp lại câu 16. Động từ "fancy" đi với V-ing.',
                rationale_vi: 'Cấu trúc: Do + S + fancy + V-ing + N?',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['The workers', 'than you.', 'earlier', 'arrived'],
                correctAnswer: 'The workers arrived earlier than you.',
                hint_vi: 'Lặp lại câu 17. So sánh hơn với trạng từ ("earlier").',
                rationale_vi: 'Cấu trúc: S + V + trạng từ so sánh hơn + than + N.',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['museums.', 'I', 'love', 'visiting'],
                correctAnswer: 'I love visiting museums.',
                hint_vi: 'Lặp lại câu 18. Động từ "love" đi với V-ing.',
                rationale_vi: 'Cấu trúc: S + V + V-ing + N.',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['update it.', "don't", 'I', 'often'],
                correctAnswer: "I don't often update it.",
                hint_vi: 'Lặp lại câu 19. Trạng từ tần suất "often" đứng sau trợ động từ.',
                rationale_vi: 'Cấu trúc phủ định: S + don\'t + often + V nguyên mẫu + O.',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['Developing', 'an understanding', 'of local', 'traditions', 'is not easy.'],
                correctAnswer: 'Developing an understanding of local traditions is not easy.',
                hint_vi: 'Lặp lại câu 20. Danh động từ làm chủ ngữ (Developing...).',
                rationale_vi: 'Cấu trúc: V-ing phrase (Developing an understanding...) + to be + adj.',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['The buffaloes', 'are drinking', 'slowly.', 'more', 'water'],
                correctAnswer: 'The buffaloes are drinking water more slowly.',
                hint_vi: 'Lặp lại câu 21. So sánh hơn với trạng từ dài ("more slowly").',
                rationale_vi: 'Cấu trúc: S + V + N + more + trạng từ + ...',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['The singer', "can't", 'sing', 'more beautifully', 'than her father.'],
                correctAnswer: "The singer can't sing more beautifully than her father.",
                hint_vi: 'So sánh hơn với trạng từ dài ("more beautifully").',
                rationale_vi: 'Cấu trúc: S + can\'t + V + more + trạng từ + than + N.',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['The fields', 'look', 'greener', 'if', 'it', 'rain', 'tomorrow.'],
                correctAnswer: 'The fields look greener if it rains tomorrow.',
                hint_vi: 'Lặp lại câu 27. Câu điều kiện loại 1.',
                rationale_vi: 'Cấu trúc câu điều kiện loại 1: Mệnh đề kết quả (The fields look greener - Hiện tại đơn) + if + Mệnh đề điều kiện (it rains tomorrow - Hiện tại đơn).',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['I', 'can listen', 'Vietnamese', 'more clearly', 'now than I did', 'last month.'],
                correctAnswer: 'I can listen Vietnamese more clearly now than I did last month.',
                hint_vi: 'So sánh hơn với trạng từ dài ("more clearly") trong thì hiện tại so với quá khứ.',
                rationale_vi: 'Cấu trúc: S + can + V + O + more + trạng từ + now than + S + did + last month.',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['Sofia was', 'a beautiful girl,', "didn't study", 'but she', 'well.'],
                correctAnswer: "Sofia was a beautiful girl, but she didn't study well.",
                hint_vi: 'Nối hai mệnh đề tương phản bằng "but".',
                rationale_vi: 'Cấu trúc: Mệnh đề 1 + but + Mệnh đề 2 (phủ định, quá khứ đơn).',
            },

            // --- Part 2 & 5: Fill in the blank (41 questions) ---
            {
                type: 'fill-in-the-blank',
                question: 'C____',
                correctAnswer: 'Custom',
                hint_vi: 'Từ này có nghĩa là phong tục, tập quán.',
                rationale_vi: 'Custom (phong tục) là danh từ thường được dùng trong ngữ cảnh này.',
            },
            {
                type: 'fill-in-the-blank',
                question: 'W____ will teach you how to fold origami tomorrow? - My teacher.',
                correctAnswer: 'Who',
                hint_vi: 'Từ hỏi về người.',
                rationale_vi: 'Who (ai) là từ hỏi về chủ ngữ là người.',
            },
            {
                type: 'fill-in-the-blank',
                question: "St. Patrick's Day is March ____",
                correctAnswer: 'seventeenth',
                hint_vi: 'Số thứ tự của ngày 17.',
                rationale_vi: 'Ngày Thánh Patrick là ngày 17 tháng 3 (seventeenth).',
            },
            {
                type: 'fill-in-the-blank',
                question: "A: Are you going to Joe's ____? B: Yes, I am.",
                correctAnswer: 'party',
                hint_vi: 'Một sự kiện xã hội mà Joe tổ chức.',
                rationale_vi: 'Câu hỏi về việc đi dự tiệc (party).',
            },
            {
                type: 'fill-in-the-blank',
                question: 'They detest g____ to crowded places in their free time.',
                correctAnswer: 'going',
                hint_vi: 'Động từ "detest" đi với V-ing.',
                rationale_vi: 'Cấu trúc: detest + V-ing (ghét làm gì).',
            },
            {
                type: 'fill-in-the-blank',
                question: 'She knits more carefully t____ I do.',
                correctAnswer: 'than',
                hint_vi: 'Từ được sử dụng trong cấu trúc so sánh hơn.',
                rationale_vi: 'Cấu trúc so sánh hơn: more carefully than (cẩn thận hơn tôi).',
            },
            {
                type: 'fill-in-the-blank',
                question: 'HOS____',
                correctAnswer: 'hospital',
                hint_vi: 'Tên của một cơ sở y tế. (8 ký tự)',
                rationale_vi: 'Hospital (bệnh viện) là danh từ phù hợp.',
            },
            {
                type: 'fill-in-the-blank',
                question: 'There are a lot ____ poultry on the farm.',
                correctAnswer: 'of',
                hint_vi: 'Cụm từ chỉ số lượng lớn ("a lot...").',
                rationale_vi: 'Cấu trúc: a lot of (rất nhiều).',
            },
            {
                type: 'fill-in-the-blank',
                question: 'Many tourists vis____ the historical pagoda in the village.',
                correctAnswer: 'visit',
                hint_vi: 'Hành động ở thì Hiện tại đơn.',
                rationale_vi: 'Chủ ngữ số nhiều ("Many tourists") nên động từ giữ nguyên mẫu (visit).',
            },
            {
                type: 'fill-in-the-blank',
                question: 'HCl is the chemical sy____ of Hydrochloric acid.',
                correctAnswer: 'symbol',
                hint_vi: 'Danh từ có nghĩa là biểu tượng.',
                rationale_vi: 'Symbol (ký hiệu) hóa học của axit clohydric.',
            },
            {
                type: 'fill-in-the-blank',
                question: 'Gwen likes working in the g____.',
                correctAnswer: 'garden',
                hint_vi: 'Nơi có cây cối, hoa lá.',
                rationale_vi: 'Gwen thích làm việc trong garden (khu vườn).',
            },
            {
                type: 'fill-in-the-blank',
                question: '____ you milk the cows yesterday morning?',
                correctAnswer: 'Did',
                hint_vi: 'Câu hỏi Yes/No ở thì Quá khứ đơn.',
                rationale_vi: 'Dấu hiệu "yesterday morning" (sáng hôm qua) dùng trợ động từ "Did".',
            },
            {
                type: 'fill-in-the-blank',
                question: 'He lov____ listening to folk music.',
                correctAnswer: 'loves',
                hint_vi: 'Động từ "love" ở thì Hiện tại đơn với chủ ngữ "He".',
                rationale_vi: 'Thì Hiện tại đơn: chủ ngữ ngôi thứ ba số ít (He) thì động từ (love) thêm "s".',
            },
            {
                type: 'fill-in-the-blank',
                question: 'The ethnic diversity in Vietnam helps enrich ____ country\'s culture.',
                correctAnswer: 'the',
                hint_vi: 'Mạo từ xác định cho một danh từ cụ thể.',
                rationale_vi: 'The country\'s culture (văn hóa của đất nước) dùng mạo từ xác định "the".',
            },
            {
                type: 'fill-in-the-blank',
                question: 'We can visit the museum ____ go to the park for a picnic.',
                correctAnswer: 'or',
                hint_vi: 'Liên từ thể hiện sự lựa chọn.',
                rationale_vi: 'Or (hoặc) thể hiện sự lựa chọn giữa hai hoạt động.',
            },
            {
                type: 'fill-in-the-blank',
                question: 'I prefer fresh air, ____ I spend a lot of time outdoors.',
                correctAnswer: 'so',
                hint_vi: 'Liên từ thể hiện kết quả.',
                rationale_vi: 'So (vì vậy) thể hiện kết quả: Tôi thích không khí trong lành, vì vậy tôi dành nhiều thời gian ngoài trời.',
            },
            {
                type: 'fill-in-the-blank',
                question: 'Teenagers need to be responsible ____ their actions.',
                correctAnswer: 'for',
                hint_vi: 'Giới từ đi với "responsible".',
                rationale_vi: 'Cấu trúc: to be responsible for (chịu trách nhiệm về).',
            },
            {
                type: 'fill-in-the-blank',
                question: 'He is crazy ____ football.',
                correctAnswer: 'about',
                hint_vi: 'Giới từ đi với "crazy".',
                rationale_vi: 'Cấu trúc: to be crazy about (phát cuồng về).',
            },
            {
                type: 'fill-in-the-blank',
                question: 'I r____ about traditional customs in Vietnam last night.',
                correctAnswer: 'read',
                hint_vi: 'Hành động xảy ra trong quá khứ ("last night"). V2 của "read" là "read".',
                rationale_vi: 'Thì Quá khứ đơn: read (dạng quá khứ của read).',
            },
            {
                type: 'fill-in-the-blank',
                question: 'She can not ____ her homework.',
                correctAnswer: 'finish',
                hint_vi: 'Động từ nguyên mẫu sau "can not".',
                rationale_vi: 'Cấu trúc: S + can not + V nguyên mẫu.',
            },
            {
                type: 'fill-in-the-blank',
                question: 'We often ____ at the park on Sundays to play games together.',
                correctAnswer: 'hang out',
                hint_vi: 'Cụm động từ có nghĩa là đi chơi.',
                rationale_vi: 'Hang out (đi chơi, dành thời gian) là cụm động từ phù hợp.',
            },
            {
                type: 'fill-in-the-blank',
                question: "She's fond ____ her home with handmade crafts.",
                correctAnswer: 'of decorating',
                hint_vi: 'Cấu trúc "fond of + V-ing".',
                rationale_vi: 'Cấu trúc: fond of decorating (thích trang trí).',
            },
            {
                type: 'fill-in-the-blank',
                question: 'He enjoys su____ the Internet and listening to music.',
                correctAnswer: 'surfing',
                hint_vi: 'Động từ "enjoy" đi với V-ing.',
                rationale_vi: 'Cấu trúc: enjoy + V-ing. Surfing (lướt web).',
            },
            {
                type: 'fill-in-the-blank',
                question: 'The tallest m____ in the world is Mount Everest.',
                correctAnswer: 'mountain',
                hint_vi: 'Tên một dạng địa hình tự nhiên.',
                rationale_vi: 'Mountain (núi) Everest là đỉnh núi cao nhất thế giới.',
            },
            {
                type: 'fill-in-the-blank',
                question: 'Wind is a ren____ energy.',
                correctAnswer: 'renewable',
                hint_vi: 'Tính từ có nghĩa là có thể tái tạo.',
                rationale_vi: 'Renewable (tái tạo) energy (năng lượng).',
            },
            {
                type: 'fill-in-the-blank',
                question: 'I want to hang ____ with my friends this afternoon.',
                correctAnswer: 'out',
                hint_vi: 'Phần còn lại của cụm động từ "hang out".',
                rationale_vi: 'Hang out (đi chơi).',
            },
            {
                type: 'fill-in-the-blank',
                question: 'It is important to preserve our customs for future gene____',
                correctAnswer: 'generations',
                hint_vi: 'Danh từ số nhiều có nghĩa là thế hệ.',
                rationale_vi: 'Generations (các thế hệ) là danh từ số nhiều phù hợp.',
            },
            {
                type: 'fill-in-the-blank',
                question: 'The w____-trained dogs help the farmers herd the cattle.',
                correctAnswer: 'well',
                hint_vi: 'Trạng từ đi với V3/ed để tạo thành tính từ ghép.',
                rationale_vi: 'Well-trained (được huấn luyện tốt).',
            },
            {
                type: 'fill-in-the-blank',
                question: 'I w____ take part in the local traditional games tomorrow.',
                correctAnswer: 'will',
                hint_vi: 'Trợ động từ của thì Tương lai đơn ("tomorrow").',
                rationale_vi: 'Will (sẽ) là trợ động từ Tương lai đơn.',
            },
            {
                type: 'fill-in-the-blank',
                question: "We don't have m____ opportunities to visit the countryside.",
                correctAnswer: 'many',
                hint_vi: 'Lượng từ cho danh từ đếm được số nhiều ("opportunities").',
                rationale_vi: 'Many (nhiều) dùng cho danh từ đếm được số nhiều.',
            },
            {
                type: 'fill-in-the-blank',
                question: 'A store has thirty cupcakes, and they sold twelve cupcakes. Now, they have ____ cupcakes left.',
                correctAnswer: 'eighteen',
                hint_vi: 'Phép trừ đơn giản: 30 - 12.',
                rationale_vi: '30 trừ 12 bằng 18 (eighteen).',
            },
            {
                type: 'fill-in-the-blank',
                question: 'Give the correct form of the word ATTRACT in the following sentence: Many tourists visit the terraced fields because they are so attrac____',
                correctAnswer: 'attractive',
                hint_vi: 'Cần một tính từ sau "so".',
                rationale_vi: 'Tính từ của "ATTRACT" là "attractive" (hấp dẫn).',
            },
            {
                type: 'fill-in-the-blank',
                question: 'Some people in the countryside still use old-fa____ tools for farming.',
                correctAnswer: 'old-fashioned',
                hint_vi: 'Tính từ ghép có nghĩa là lỗi thời.',
                rationale_vi: 'Old-fashioned (lỗi thời) là tính từ ghép.',
            },
            {
                type: 'fill-in-the-blank',
                question: 'In Thailand, people use the wai ____ when they meet friends.',
                correctAnswer: 'greeting',
                hint_vi: 'Danh từ có nghĩa là lời chào, hành động chào.',
                rationale_vi: 'The wai greeting (cách chào bằng hành động wai).',
            },
            {
                type: 'fill-in-the-blank',
                question: 'Give the correct form of the word ACTIVE in the following sentence: One popular acti____ during the festival is lion dancing.',
                correctAnswer: 'activity',
                hint_vi: 'Cần một danh từ số ít.',
                rationale_vi: 'Danh từ của "ACTIVE" là "activity" (hoạt động).',
            },
            {
                type: 'fill-in-the-blank',
                question: 'I enjoy learning new l____ in my free time. Now, I\'m learning Spanish and Japanese.',
                correctAnswer: 'languages',
                hint_vi: 'Danh từ số nhiều chỉ loại hình học tập (như tiếng Tây Ban Nha, Nhật Bản).',
                rationale_vi: 'Languages (ngôn ngữ) là danh từ số nhiều phù hợp.',
            },
            {
                type: 'fill-in-the-blank',
                question: 'W____ musical instrument do you want to play? - The bamboo flute seems better.',
                correctAnswer: 'Which',
                hint_vi: 'Từ hỏi về sự lựa chọn (cụ thể).',
                rationale_vi: 'Which (cái nào) dùng để hỏi về sự lựa chọn giữa các nhạc cụ.',
            },
            {
                type: 'fill-in-the-blank',
                question: 'People decorate their homes with or____ trees during the Lunar New Year.',
                correctAnswer: 'ornamental',
                hint_vi: 'Tính từ có nghĩa là trang trí.',
                rationale_vi: 'Ornamental (trang trí) là tính từ bổ nghĩa cho "trees".',
            },
            {
                type: 'fill-in-the-blank',
                question: 'I always look forward ____ the summer festival every year.',
                correctAnswer: 'to',
                hint_vi: 'Giới từ trong cụm động từ "look forward to".',
                rationale_vi: 'Cấu trúc: look forward to + V-ing/N (mong chờ).',
            },
            {
                type: 'fill-in-the-blank',
                question: 'W____ will you meet your friends next weekend? - In the park.',
                correctAnswer: 'Where',
                hint_vi: 'Câu trả lời là một địa điểm ("In the park"), nên hỏi về nơi chốn.',
                rationale_vi: 'Where (ở đâu) là từ hỏi về nơi chốn.',
            },
            {
                type: 'fill-in-the-blank',
                question: 'The music of the ethnic groups is ____ during festivals.',
                correctAnswer: 'livelier',
                hint_vi: 'Dạng so sánh hơn của tính từ ("lively").',
                rationale_vi: 'Livelier (sống động hơn) là dạng so sánh hơn.',
            },
            {
                type: 'fill-in-the-blank',
                question: 'Look out of the window and you can see trees and ____. It\'s a wonderful view.',
                correctAnswer: 'fields',
                hint_vi: 'Một dạng địa hình nông thôn, số nhiều.',
                rationale_vi: 'Fields (cánh đồng) là một phần của cảnh quan tuyệt vời ở nông thôn.',
            },
            {
                type: 'fill-in-the-blank',
                question: 'Life in the countryside allows people to be closer to ____.',
                correctAnswer: 'nature',
                hint_vi: 'Danh từ chỉ môi trường tự nhiên.',
                rationale_vi: 'Closer to nature (gần gũi với thiên nhiên).',
            },
            {
                type: 'fill-in-the-blank',
                question: 'Joining ____ helps you make new friends.',
                correctAnswer: 'clubs',
                hint_vi: 'Một hoạt động xã hội (danh từ số nhiều).',
                rationale_vi: 'Joining clubs (tham gia câu lạc bộ) giúp kết bạn.',
            },
            {
                type: 'fill-in-the-blank',
                question: 'The ceremony takes ____ in the city square every year.',
                correctAnswer: 'place',
                hint_vi: 'Phần còn lại của cụm động từ "take place".',
                rationale_vi: 'Take place (diễn ra).',
            },
            {
                type: 'fill-in-the-blank',
                question: 'Is the ____ largest ethnic group in Viet Nam?',
                correctAnswer: 'Ede',
                hint_vi: 'Tên một dân tộc thiểu số. (3 ký tự)',
                rationale_vi: 'Ede (dân tộc Ê-đê) là một dân tộc thiểu số ở Việt Nam. (Giả định Ede là đáp án, do thiếu ngữ cảnh về số liệu).',
            },
            {
                type: 'fill-in-the-blank',
                question: 'Teens should prepare food, wash dishes, and do chores at home. They\'re ____.',
                correctAnswer: 'self-care',
                hint_vi: 'Hành động chăm sóc bản thân hoặc tự lập.',
                rationale_vi: 'Các hoạt động này là self-care (tự chăm sóc) hoặc self-reliant (tự lập). Chọn self-care theo đề.',
            },
            {
                type: 'fill-in-the-blank',
                question: 'Mai is checking ____ to see some new posts.',
                correctAnswer: 'the notifications',
                hint_vi: 'Cô ấy đang kiểm tra cái gì trên mạng xã hội?',
                rationale_vi: 'Checking the notifications (kiểm tra thông báo).',
            },
            {
                type: 'fill-in-the-blank',
                question: 'She completed the DIY project more creati____ than expected.',
                correctAnswer: 'creatively',
                hint_vi: 'Cần một trạng từ bổ nghĩa cho động từ "completed".',
                rationale_vi: 'Creatively (sáng tạo) là trạng từ của creative.',
            },
            {
                type: 'fill-in-the-blank',
                question: 'The French Revolution began in ____.',
                correctAnswer: '1789',
                hint_vi: 'Năm diễn ra Cách mạng Pháp.',
                rationale_vi: 'Cách mạng Pháp bắt đầu năm 1789.',
            },
            {
                type: 'fill-in-the-blank',
                question: '____ is a time of exploration and learning new things.',
                correctAnswer: 'Youth',
                hint_vi: 'Thời kỳ tuổi trẻ, thanh thiếu niên.',
                rationale_vi: 'Youth (tuổi trẻ) là thời điểm khám phá và học hỏi.',
            },
            {
                type: 'fill-in-the-blank',
                question: 'Travelling to new places is an ____ way to spend your vacation.',
                correctAnswer: 'exciting',
                hint_vi: 'Cần một tính từ bắt đầu bằng nguyên âm.',
                rationale_vi: 'Exciting (thú vị) là tính từ mô tả "way".',
            },
            {
                type: 'fill-in-the-blank',
                question: 'The countryside is full of ____ sites that tell the story of the village\'s rich history.',
                correctAnswer: 'historical',
                hint_vi: 'Cần một tính từ liên quan đến lịch sử.',
                rationale_vi: 'Historical (có tính lịch sử) sites (di tích).',
            },
            {
                type: 'fill-in-the-blank',
                question: 'If we go to the market early, we ____ get fresh vegetables.',
                correctAnswer: 'will',
                hint_vi: 'Mệnh đề chính của câu điều kiện loại 1.',
                rationale_vi: 'Cấu trúc câu điều kiện loại 1 (Hiện tại đơn, will + V).',
            },
            {
                type: 'fill-in-the-blank',
                question: 'Those kids really study hard and worry about their gr____.',
                correctAnswer: 'grades',
                hint_vi: 'Danh từ số nhiều có nghĩa là điểm số.',
                rationale_vi: 'Grades (điểm số).',
            },
            {
                type: 'fill-in-the-blank',
                question: 'It\'s time for him ____ his maturity with his golf and realize he ____ every time.',
                correctAnswer: 'to match / doesn\'t win',
                hint_vi: 'Cấu trúc "It\'s time for S + to V" và Hiện tại đơn phủ định.',
                rationale_vi: 'It\'s time for him **to match**... he **doesn\'t win** (Thì Hiện tại đơn, vì là sự thật hoặc thói quen).',
            },
            {
                type: 'fill-in-the-blank',
                question: 'Teenagers should relax after a long day of studying; oth____ they will feel stressed.',
                correctAnswer: 'otherwise',
                hint_vi: 'Liên từ có nghĩa là nếu không thì.',
                rationale_vi: 'Otherwise (nếu không thì) là liên từ phù hợp.',
            },
            
            // --- Part 3 & 4: Multiple Choice Questions (36 questions) ---
            {
                type: 'mc',
                question: "I don't have ____ experience with combine harvesters.",
                options: [
                    { text: 'few', isCorrect: false },
                    { text: 'several', isCorrect: false },
                    { text: 'many', isCorrect: false },
                    { text: 'much', isCorrect: true }
                ],
                correctAnswer: 'much',
                hint_vi: '"Experience" là danh từ không đếm được. Câu phủ định.',
                rationale_vi: '"Experience" (kinh nghiệm) là danh từ không đếm được, dùng "much" trong câu phủ định.',
            },
            {
                type: 'mc',
                question: 'I forgot to check my social media ____ so I missed the event.',
                options: [
                    { text: 'friends', isCorrect: false },
                    { text: 'pictures', isCorrect: false },
                    { text: 'notifications', isCorrect: true },
                    { text: 'answers', isCorrect: false }
                ],
                correctAnswer: 'notifications',
                hint_vi: 'Những thông báo từ mạng xã hội.',
                rationale_vi: 'Notifications (thông báo) là thứ cần kiểm tra để không bỏ lỡ sự kiện.',
            },
            {
                type: 'mc',
                question: 'He enjoys fishing ____ hiking on weekends.',
                options: [
                    { text: 'because', isCorrect: false },
                    { text: 'for', isCorrect: false },
                    { text: 'and', isCorrect: true },
                    { text: 'but', isCorrect: false }
                ],
                correctAnswer: 'and',
                hint_vi: 'Nối hai sở thích/hoạt động song song.',
                rationale_vi: 'Liên từ "and" nối hai danh động từ ("fishing" và "hiking") làm tân ngữ của "enjoys".',
            },
            {
                type: 'mc',
                question: 'Exams are ____ very stressful.',
                options: [
                    { text: 'are', isCorrect: true },
                    { text: 'is', isCorrect: false },
                    { text: 'were', isCorrect: false },
                    { text: 'was', isCorrect: false }
                ],
                correctAnswer: 'are',
                hint_vi: 'Động từ "to be" chia theo chủ ngữ số nhiều.',
                rationale_vi: 'Chủ ngữ "Exams" (các kỳ thi) là số nhiều, dùng "are".',
            },
            {
                type: 'mc',
                question: 'The farmer keeps both cattle and ____ on his farm.',
                options: [
                    { text: 'grain', isCorrect: false },
                    { text: 'lighthouse', isCorrect: false },
                    { text: 'ferry', isCorrect: false },
                    { text: 'poultry', isCorrect: true }
                ],
                correctAnswer: 'poultry',
                hint_vi: 'Loại vật nuôi khác ngoài gia súc (cattle) ở trang trại.',
                rationale_vi: 'Poultry (gia cầm) là loại vật nuôi thường được nuôi cùng với gia súc.',
            },
            {
                type: 'mc',
                question: '____ you ____ with your friends this Saturday?',
                options: [
                    { text: 'Does - hang out', isCorrect: false },
                    { text: 'Will - hanging out', isCorrect: false },
                    { text: 'Will - hang out', isCorrect: true },
                    { text: 'Are - hang out', isCorrect: false }
                ],
                correctAnswer: 'Will - hang out',
                hint_vi: 'Hỏi về dự định trong tương lai ("this Saturday").',
                rationale_vi: 'Cấu trúc Tương lai đơn: Will + S + V nguyên mẫu.',
            },
            {
                type: 'mc',
                question: 'I ____ horror movies; they are too scary for me.',
                options: [
                    { text: 'love', isCorrect: false },
                    { text: 'adore', isCorrect: false },
                    { text: 'prefer', isCorrect: false },
                    { text: 'detest', isCorrect: true }
                ],
                correctAnswer: 'detest',
                hint_vi: 'Cảm xúc mạnh mẽ tiêu cực (vì chúng đáng sợ).',
                rationale_vi: 'Detest (ghét cay ghét đắng) là từ phù hợp khi nói phim quá đáng sợ.',
            },
            {
                type: 'mc',
                question: 'Find the word that differs from the rest in the position of the main stress.',
                options: [
                    { text: 'legend', isCorrect: false },
                    { text: 'marriage', isCorrect: false },
                    { text: 'classmate', isCorrect: false },
                    { text: 'concern', isCorrect: true }
                ],
                correctAnswer: 'concern',
                hint_vi: 'Ba từ có trọng âm ở âm tiết thứ nhất, một từ ở âm tiết thứ hai.',
                rationale_vi: '"Concern" (conˈcern) có trọng âm ở âm tiết thứ hai. Ba từ còn lại có trọng âm ở âm tiết thứ nhất.',
            },
            {
                type: 'mc',
                question: 'The fields are vast, ____ it takes a lot of time to plough them.',
                options: [
                    { text: 'or', isCorrect: false },
                    { text: 'but', isCorrect: false },
                    { text: 'so', isCorrect: true },
                    { text: 'otherwise', isCorrect: false }
                ],
                correctAnswer: 'so',
                hint_vi: 'Mối quan hệ nguyên nhân - kết quả.',
                rationale_vi: '"So" (vì vậy) thể hiện kết quả: Cánh đồng rộng lớn (nguyên nhân), vì vậy mất nhiều thời gian để cày (kết quả).',
            },
            {
                type: 'mc',
                question: 'Teenagers are ____ a lot of peer pressure nowadays.',
                options: [
                    { text: 'faces', isCorrect: false },
                    { text: 'faced', isCorrect: false },
                    { text: 'facing', isCorrect: true },
                    { text: 'face', isCorrect: false }
                ],
                correctAnswer: 'facing',
                hint_vi: 'Thì Hiện tại tiếp diễn ("are + V-ing") hoặc cấu trúc "face pressure".',
                rationale_vi: 'Cấu trúc "to be facing" (đang đối mặt) ở thì Hiện tại tiếp diễn.',
            },
            {
                type: 'mc',
                question: 'The farmer has ____ vast field of paddy for harvest.',
                options: [
                    { text: 'an', isCorrect: false },
                    { text: 'they', isCorrect: false },
                    { text: 'a', isCorrect: true },
                    { text: 'two', isCorrect: false }
                ],
                correctAnswer: 'a',
                hint_vi: 'Sử dụng mạo từ không xác định với danh từ đếm được số ít.',
                rationale_vi: '"Field" (cánh đồng) là danh từ đếm được số ít, và "vast" bắt đầu bằng phụ âm, nên dùng "a".',
            },
            {
                type: 'mc',
                question: 'Who invented the telephone?',
                options: [
                    { text: 'Thomas Edison', isCorrect: false },
                    { text: 'Alexander Graham Bell', isCorrect: true },
                    { text: 'Guglielmo Marconi', isCorrect: false },
                    { text: 'Nikola Tesla', isCorrect: false }
                ],
                correctAnswer: 'Alexander Graham Bell',
                hint_vi: 'Câu hỏi kiến thức chung về lịch sử phát minh.',
                rationale_vi: 'Alexander Graham Bell là người phát minh ra điện thoại.',
            },
            {
                type: 'mc',
                question: 'Decorative ____ are cheap.',
                options: [
                    { text: 'decorative', isCorrect: false },
                    { text: 'cheap', isCorrect: false },
                    { text: 'items', isCorrect: true },
                    { text: 'are', isCorrect: false }
                ],
                correctAnswer: 'items',
                hint_vi: 'Cần danh từ số nhiều để làm chủ ngữ cho động từ "are".',
                rationale_vi: 'Decorative items (các món đồ trang trí) là danh từ ghép làm chủ ngữ số nhiều.',
            },
            {
                type: 'mc',
                question: 'Your fields are ____ picturesque.',
                options: [
                    { text: 'your', isCorrect: false },
                    { text: 'are', isCorrect: false },
                    { text: 'fields', isCorrect: false },
                    { text: 'picturesque', isCorrect: true } // Sửa lỗi trong câu này
                ],
                correctAnswer: 'picturesque',
                hint_vi: 'Phần cần sửa trong câu: "Your fields are picturesque".',
                rationale_vi: 'Câu gốc không sai ("Your fields are picturesque"). Tuy nhiên, nếu đề thi yêu cầu sửa lỗi trong câu này, từ có khả năng gây lỗi nhất là "picturesque" (thường không dùng làm trạng từ). Giả định câu hỏi muốn tìm từ sai trong ngữ cảnh hoặc tìm tính từ chính.',
            },
            {
                type: 'mc',
                question: 'People believe the lion dance helps ____ bad spirits and bring good luck.',
                options: [
                    { text: 'enjoy', isCorrect: false },
                    { text: 'chase away', isCorrect: true },
                    { text: 'welcome', isCorrect: false },
                    { text: 'ignore', isCorrect: false }
                ],
                correctAnswer: 'chase away',
                hint_vi: 'Mục đích của múa lân là xua đuổi tà ma.',
                rationale_vi: 'Cụm động từ "chase away" (xua đuổi) phù hợp với "bad spirits" (tà ma).',
            },
            {
                type: 'mc',
                question: '____ traditions take place near the riverside to celebrate the local culture and history.',
                options: [
                    { text: 'Several', isCorrect: true },
                    { text: 'Much', isCorrect: false },
                    { text: 'Every', isCorrect: false },
                    { text: 'A little', isCorrect: false }
                ],
                correctAnswer: 'Several',
                hint_vi: 'Lượng từ cho danh từ đếm được số nhiều ("traditions").',
                rationale_vi: 'Several (một vài/một số) dùng cho danh từ đếm được số nhiều.',
            },
            {
                type: 'mc',
                question: 'He/collect/coins/ different/countries.',
                options: [
                    { text: 'He collect coins from different countries.', isCorrect: false },
                    { text: 'He collects coin from different countries.', isCorrect: false },
                    { text: 'He collects of different country.', isCorrect: false },
                    { text: 'He collects coins from different countries.', isCorrect: true }
                ],
                correctAnswer: 'He collects coins from different countries.',
                hint_vi: 'Chia động từ đúng (thêm -s) và dùng giới từ đúng ("from").',
                rationale_vi: 'Câu đúng phải có: "He collects" (Hiện tại đơn) và "from different countries".',
            },
            {
                type: 'mc',
                question: 'Emily has 21 candies. She gives her friends 7 of them. How many candies does she have left?',
                options: [
                    { text: '11', isCorrect: false },
                    { text: '14', isCorrect: true },
                    { text: '13', isCorrect: false },
                    { text: '12', isCorrect: false }
                ],
                correctAnswer: '14',
                hint_vi: 'Phép tính: $21 - 7$.',
                rationale_vi: '21 trừ 7 bằng 14. (21 - 7 = 14).',
            },
            {
                type: 'mc',
                question: 'Find the word that differs from the rest in the position of the main stress.',
                options: [
                    { text: 'admire', isCorrect: false },
                    { text: 'unique', isCorrect: false },
                    { text: 'unload', isCorrect: false },
                    { text: 'orchard', isCorrect: true }
                ],
                correctAnswer: 'orchard',
                hint_vi: 'Tìm từ có trọng âm ở âm tiết thứ nhất.',
                rationale_vi: '"Orchard" (ˈɔːr.tʃərd) có trọng âm ở âm tiết thứ nhất. Ba từ còn lại có trọng âm ở âm tiết thứ hai.',
            },
            {
                type: 'mc',
                question: 'Five-colour sticky rice is a unique ____ in some ethnic cultures.',
                options: [
                    { text: 'dish', isCorrect: true },
                    { text: 'foods', isCorrect: false },
                    { text: 'specialities', isCorrect: false },
                    { text: 'dishes', isCorrect: false }
                ],
                correctAnswer: 'dish',
                hint_vi: 'Sử dụng danh từ đếm được số ít sau "a unique".',
                rationale_vi: '"Dish" (món ăn) là danh từ đếm được số ít, phù hợp với mạo từ "a".',
            },
            {
                type: 'mc',
                question: 'There are 28 cookies, and 4 friends want to share them equally. How many cookies will each friend get?',
                options: [
                    { text: '7', isCorrect: true },
                    { text: '6', isCorrect: false },
                    { text: '8', isCorrect: false },
                    { text: '9', isCorrect: false }
                ],
                correctAnswer: '7',
                hint_vi: 'Phép tính: $28 \\div 4$.',
                rationale_vi: '28 chia 4 bằng 7. (28 $\\div$ 4 = 7).',
            },
            {
                type: 'mc',
                question: 'Find the word which has a different sound in the underlined part.',
                options: [
                    { text: 'eff<u>o</u>rt', isCorrect: true },
                    { text: 'communicati<u>o</u>n', isCorrect: false },
                    { text: 'c<u>o</u>wboy', isCorrect: false },
                    { text: 'sec<u>o</u>nd', isCorrect: true }
                ],
                correctAnswer: 'effort', // /e/ vs /ə/ hoặc /aʊ/
                hint_vi: 'Từ "effort" có âm /e/. Các từ khác có âm /ə/ (communication, second) hoặc /aʊ/ (cowboy).',
                rationale_vi: 'Chữ "o" trong "effort" phát âm là /e/. Chữ "o" trong "communication" và "second" phát âm là /ə/ (hoặc /ɪ/). Chữ "o" trong "cowboy" phát âm là /aʊ/ (hoặc /əʊ/).',
            },
            {
                type: 'mc',
                question: 'The square root of 64 is 8. The square root of 81 is ____.',
                options: [
                    { text: '7', isCorrect: false },
                    { text: '5', isCorrect: false },
                    { text: '9', isCorrect: true },
                    { text: '6', isCorrect: false }
                ],
                correctAnswer: '9',
                hint_vi: 'Căn bậc hai của 81.',
                rationale_vi: 'Căn bậc hai của 81 là 9. ($9^2 = 81$).',
            },
            {
                type: 'mc',
                question: '____ is the best time to visit a traditional festival? - On February.',
                options: [
                    { text: 'Where', isCorrect: false },
                    { text: 'How', isCorrect: false },
                    { text: 'Why', isCorrect: false },
                    { text: 'When', isCorrect: true }
                ],
                correctAnswer: 'When',
                hint_vi: 'Câu trả lời là về thời gian ("On February").',
                rationale_vi: 'When (khi nào) là từ hỏi về thời gian.',
            },
            {
                type: 'mc',
                question: 'The locals are proud of their ____ such as traditional rice cakes.',
                options: [
                    { text: 'plate', isCorrect: false },
                    { text: 'specialities', isCorrect: true },
                    { text: 'grains', isCorrect: false },
                    { text: 'cattle', isCorrect: false }
                ],
                correctAnswer: 'specialities',
                hint_vi: 'Các món ăn đặc biệt của địa phương.',
                rationale_vi: 'Specialities (đặc sản) là danh từ số nhiều, phù hợp với ví dụ là "rice cakes" (bánh gạo).',
            },
            {
                type: 'mc',
                question: '____ is the most user-friendly app for teenagers?',
                options: [
                    { text: 'Where', isCorrect: false },
                    { text: 'When', isCorrect: false },
                    { text: 'How', isCorrect: false },
                    { text: 'What', isCorrect: true }
                ],
                correctAnswer: 'What',
                hint_vi: 'Hỏi về tên của một ứng dụng.',
                rationale_vi: 'What (cái gì) dùng để hỏi về thông tin hoặc tên.',
            },
            {
                type: 'mc',
                question: 'What is one of the activities you can do in the countryside?',
                options: [
                    { text: 'Go fishing.', isCorrect: true },
                    { text: 'Have a picnic.', isCorrect: false },
                    { text: 'Visit museums.', isCorrect: false },
                    { text: 'Go to the movies.', isCorrect: false }
                ],
                correctAnswer: 'Go fishing.',
                hint_vi: 'Hoạt động phổ biến ở nông thôn.',
                rationale_vi: 'Go fishing (đi câu cá) là hoạt động phổ biến ở nông thôn, trong khi các hoạt động khác thường phổ biến ở thành phố.',
            },
            {
                type: 'mc',
                question: 'If an object moves 20 meters in 5 seconds, its speed is: ____',
                options: [
                    { text: '$10~m/s$', isCorrect: false },
                    { text: '$4~m/s$', isCorrect: true },
                    { text: '$5~m/s$', isCorrect: false },
                    { text: '$3~m/s$', isCorrect: false }
                ],
                correctAnswer: '$4~m/s$',
                hint_vi: 'Công thức tính tốc độ: $\\text{V} = \\text{S} / \\text{T}$',
                rationale_vi: 'Tốc độ bằng khoảng cách chia thời gian: $20\\text{m} / 5\\text{s} = 4\\text{m/s}$.',
            },
            {
                type: 'mc',
                question: 'Which activity is mentioned as a popular choice for people in their free time?',
                options: [
                    { text: 'Shopping for clothes.', isCorrect: false },
                    { text: 'Going to cafes.', isCorrect: false },
                    { text: 'Visiting a park.', isCorrect: true }, // Giả định
                    { text: 'Taking art classes.', isCorrect: false }
                ],
                correctAnswer: 'Visiting a park.',
                hint_vi: 'Hoạt động thư giãn ngoài trời.',
                rationale_vi: 'Visiting a park (tham quan công viên) là một lựa chọn phổ biến cho thời gian rảnh rỗi.',
            },
            {
                type: 'mc',
                question: 'What is one benefit of using leisure time for self-care, according to the audio?',
                options: [
                    { text: 'Learning new skills.', isCorrect: false },
                    { text: 'Improving work performance.', isCorrect: false },
                    { text: 'Making new friends.', isCorrect: false },
                    { text: 'Reducing stress.', isCorrect: true }
                ],
                correctAnswer: 'Reducing stress.',
                hint_vi: 'Lợi ích chính của việc tự chăm sóc bản thân.',
                rationale_vi: 'Reducing stress (giảm căng thẳng) là lợi ích quan trọng nhất của việc tự chăm sóc bản thân.',
            },
            // --- Part 4: Choose the incorrect word(s) or phrase that needs correction. (6 questions) ---
            {
                type: 'mc',
                question: 'Choose the part that needs correction in the following sentence: People in the countryside are usually <u>the</u> hospitable to visitors.',
                options: [
                    { text: 'countryside', isCorrect: false },
                    { text: 'the', isCorrect: true },
                    { text: 'People', isCorrect: false },
                    { text: 'hospitable', isCorrect: false }
                ],
                correctAnswer: 'the',
                hint_vi: 'Không cần dùng mạo từ "the" trước tính từ so sánh bằng hoặc tính từ đơn trong câu này.',
                rationale_vi: 'Không cần mạo từ "the" ở đây. Sửa thành "are usually hospitable" (thường hiếu khách).',
            },
            {
                type: 'mc',
                question: 'Choose the part that needs correction in the following sentence: The village has <u>much</u> historical temples and pagodas.',
                options: [
                    { text: 'pagodas', isCorrect: false },
                    { text: 'historical', isCorrect: false },
                    { text: 'much', isCorrect: true },
                    { text: 'The', isCorrect: false }
                ],
                correctAnswer: 'much',
                hint_vi: '"Temples and pagodas" (đền và chùa) là danh từ đếm được.',
                rationale_vi: 'Sử dụng "many" thay cho "much" vì "temples and pagodas" là danh từ đếm được số nhiều.',
            },
            {
                type: 'mc',
                question: 'Choose the part that needs correction in the following sentence: How do villagers <u>managing</u> to live without modern facilities?',
                options: [
                    { text: 'managing', isCorrect: true },
                    { text: 'modern', isCorrect: false },
                    { text: 'live', isCorrect: false },
                    { text: 'How', isCorrect: false }
                ],
                correctAnswer: 'managing',
                hint_vi: 'Sau trợ động từ "do" là động từ nguyên mẫu.',
                rationale_vi: 'Sửa "managing" thành "manage" (dạng nguyên mẫu) vì có trợ động từ "do".',
            },
            {
                type: 'mc',
                question: 'Choose the part that needs correction in the following sentence: The H\'mong people use a special <u>technical</u> to weave clothes.',
                options: [
                    { text: 'people', isCorrect: false },
                    { text: 'special', isCorrect: false },
                    { text: 'technical', isCorrect: true },
                    { text: 'weave', isCorrect: false }
                ],
                correctAnswer: 'technical',
                hint_vi: 'Sau tính từ "special" cần danh từ "technique".',
                rationale_vi: 'Sửa "technical" (tính từ) thành "technique" (danh từ, kỹ thuật).',
            },
            {
                type: 'mc',
                question: 'Choose the part that needs correction in the following sentence: Some teenagers are <u>sensitivity</u> to what others say about their appearance.',
                options: [
                    { text: 'appearance', isCorrect: false },
                    { text: 'others', isCorrect: false },
                    { text: 'sensitivity', isCorrect: true },
                    { text: 'Some', isCorrect: false }
                ],
                correctAnswer: 'sensitivity',
                hint_vi: 'Sau động từ "are" cần tính từ "sensitive" (nhạy cảm).',
                rationale_vi: 'Sửa "sensitivity" (danh từ, sự nhạy cảm) thành "sensitive" (tính từ, nhạy cảm).',
            },
            {
                type: 'mc',
                question: 'Choose the part that needs correction in the following sentence: The festival this year takes place more <u>smooth</u> than last year.',
                options: [
                    { text: 'smooth', isCorrect: true },
                    { text: 'takes', isCorrect: false },
                    { text: 'The', isCorrect: false },
                    { text: 'last', isCorrect: false }
                ],
                correctAnswer: 'smooth',
                hint_vi: 'Cần trạng từ "smoothly" để bổ nghĩa cho động từ "takes place".',
                rationale_vi: 'Sửa "smooth" (tính từ) thành "smoothly" (trạng từ) vì nó bổ nghĩa cho động từ "takes place" và nằm trong cấu trúc so sánh hơn (more smoothly).',
            }
        ];

        // --- State Management (Dữ liệu toàn cục) ---
        let gameState = 'start';
        let playerName = '';
        let score = 0;
        let shuffledQuestions = [];
        let currentQuestionIndex = 0;
        let isAnswered = false;
        let scoredThisQuestion = false;
        let isCorrect = false;
        let submittedAnswer = '';
        let message = null;

        const appRoot = document.querySelector('#app-root > div');

        // --- Utility Functions ---

        /**
         * Hàm xáo trộn mảng câu hỏi (Fisher-Yates)
         */
        function shuffleArray(array) {
            let newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        /**
         * Hiển thị thông báo (MessageBox)
         */
        function showMessage(text, type) {
            message = { text, type };
            renderApp();
            setTimeout(() => {
                message = null; 
            }, 3000); 
        }
        
        /**
         * Xóa MessageBox đang hiển thị trên DOM
         */
        function clearMessageBox() {
            let oldMsg = document.getElementById('message-box-container');
            if(oldMsg) oldMsg.remove();
            message = null;
        }


        /**
         * Lấy HTML cho MessageBox
         */
        function renderMessageBox() {
            if (!message) return '';

            const baseClasses = "fixed top-4 left-1/2 -translate-x-1/2 p-4 rounded-xl border-b-4 shadow-2xl text-center font-semibold text-lg z-50 transition-all ease-in-out duration-500 transform w-11/12 max-w-md";
            
            const typeClasses = {
                success: 'bg-green-50 border-green-600 text-green-800',
                error: 'bg-red-50 border-red-600 text-red-800',
                info: 'bg-yellow-100 border-yellow-500 text-yellow-800', 
            };

            const messageHtml = `
                <div class="${baseClasses} ${typeClasses[message.type]} opacity-100 scale-100 translate-y-0">
                    ${message.text}
                </div>
            `;
            
            let oldMsg = document.getElementById('message-box-container');
            if(oldMsg) oldMsg.remove();

            let container = document.createElement('div');
            container.id = 'message-box-container';
            container.innerHTML = messageHtml;
            document.body.appendChild(container);
        }
        
        /**
         * Lấy HTML cho ProgressBar
         */
        function renderProgressBar(percentage) {
            return `
                <div class="w-full h-2 bg-blue-100 rounded-full mt-4 overflow-hidden">
                    <div
                        class="h-full bg-blue-500 transition-all duration-500 ease-in-out"
                        style="width: ${percentage}%;"
                    ></div>
                </div>
            `;
        }

        /**
         * Lấy HTML cho RationaleBox
         */
        function renderRationaleBox(question, isCorrect, submittedAnswer) {
            const boxClasses = `mt-6 p-4 rounded-lg border transition duration-300 fade-in border-l-4 ${
                isCorrect ? 'bg-green-100 border-green-600' : 'bg-red-100 border-red-600'
            }`;

            let submittedDisplay = '';
            if (!isCorrect || question.type === 'fill-in-the-blank') {
                submittedDisplay = `
                    <strong>${question.type === 'mc' ? 'Bạn đã chọn: ' : 'Câu trả lời của bạn: '}</strong>
                    <span class="text-red-700 font-medium">${submittedAnswer}</span>
                    <br/>
                `;
            }

            return `
                <div id="rationale-box" class="${boxClasses}">
                    <p class="font-bold text-lg mb-2 text-blue-700">Giải thích (Rationale):</p>
                    <div class="text-gray-700">
                        ${submittedDisplay}
                        <strong>Đáp án đúng:</strong> ${question.correctAnswer} <br />
                        ${question.rationale_vi}
                    </div>
                </div>
            `;
        }

        // --- Core Logic ---

        function handleStartQuiz(name) {
            playerName = name;
            score = 0;
            currentQuestionIndex = 0;
            shuffledQuestions = shuffleArray(questions);
            gameState = 'quiz';
            renderApp();
        }

        function handleEndQuiz() {
            gameState = 'end';
            renderApp();
        }

        function handleRestartQuiz() {
            playerName = '';
            score = 0;
            currentQuestionIndex = 0;
            gameState = 'start';
            renderApp();
        }

        function handleSubmit(answer, isAnswerCorrect) {
            if (isAnswered) return;
            
            isAnswered = true;
            submittedAnswer = answer;
            isCorrect = isAnswerCorrect;

            if (isAnswerCorrect && !scoredThisQuestion) {
                score += 10;
                scoredThisQuestion = true;
                showMessage('CHÍNH XÁC! +10 điểm. Tuyệt vời!', 'success');
            } else if (isAnswerCorrect && scoredThisQuestion) {
                showMessage('CHÍNH XÁC! Nhưng điểm đã được tính rồi.', 'info');
            } else {
                showMessage('SAI RỒI! Vui lòng xem giải thích và học hỏi.', 'error');
            }
            renderApp();
        }

        function handleNext() {
            clearMessageBox(); 
            const rationaleBox = document.getElementById('rationale-box');
            if(rationaleBox) rationaleBox.remove();
            
            if (currentQuestionIndex < shuffledQuestions.length - 1) {
                currentQuestionIndex++;
                isAnswered = false;
                scoredThisQuestion = false;
                isCorrect = false;
                submittedAnswer = '';
                renderApp();
            } else {
                handleEndQuiz();
            }
        }
        
        // --- Render Components (as HTML strings) ---

        function renderStartScreen() {
            return `
                <div class="fade-in text-center">
                    <header class="mb-8">
                        <h1 class="text-3xl sm:text-4xl font-extrabold text-blue-600 mb-2">Bài Thi Thử IOE Lớp 8</h1>
                        <p class="text-lg text-gray-500">Sắp xếp câu, Điền từ & Trắc nghiệm Tiếng Anh</p>
                    </header>
                    <div class="max-w-md mx-auto">
                        <h2 class="text-2xl font-semibold mb-4">Chào mừng đến với bài thi!</h2>
                        <p class="text-gray-600 mb-6">Mỗi câu trả lời đúng lần đầu được cộng 10 điểm. Tổng cộng ${questions.length} câu.</p>
                        <div class="space-y-4">
                            <label for="player-name" class="block text-sm font-medium text-gray-700 text-left">Nhập tên của bạn để bắt đầu:</label>
                            <input
                                type="text"
                                id="player-name"
                                placeholder="Tên người chơi"
                                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 text-lg shadow-sm"
                                maxlength="50"
                                value="${playerName}"
                            />
                            <button
                                id="start-button"
                                class="w-full py-3 px-4 bg-blue-500 text-white font-bold rounded-lg shadow-md transition duration-300 hover:bg-blue-600 disabled:bg-gray-300 disabled:cursor-not-allowed text-xl"
                            >
                                Bắt Đầu Thi
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function setupStartScreenListeners() {
            const nameInput = document.getElementById('player-name');
            const startButton = document.getElementById('start-button');

            if (!nameInput || !startButton) return;

            const updateButtonState = () => {
                startButton.disabled = nameInput.value.trim() === '';
            };

            nameInput.addEventListener('input', updateButtonState);
            startButton.addEventListener('click', () => {
                const name = nameInput.value.trim();
                if (name) handleStartQuiz(name);
            });
            nameInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && nameInput.value.trim() !== '') {
                    startButton.click();
                }
            });
            updateButtonState();
        }

        function renderEndScreen() {
            const finalScore = score;
            const totalQuestions = questions.length;
            const maxScore = totalQuestions * 10;
            const percentage = Math.round((finalScore / maxScore) * 100);
            
            return `
                <div class="text-center fade-in">
                    <h2 class="text-3xl font-bold mb-4 text-green-600">🎉 Hoàn Thành Bài Thi! 🎉</h2>
                    <p class="text-xl text-gray-700 mb-6">
                        Chúc mừng, <span class="font-extrabold text-blue-600">${playerName}</span>!
                    </p>
                    <div class="mb-8 bg-blue-50 p-6 rounded-lg shadow-inner">
                        <p class="text-2xl font-semibold mb-2 text-gray-800">Điểm số cuối cùng của bạn là:</p>
                        <p class="text-6xl font-black text-red-700 mb-4">${finalScore}</p>
                        <p class="text-lg text-gray-600">
                            Đạt được ${score}/${maxScore} x 100% = ${percentage}% số điểm tối đa
                        </p>
                    </div>
                    <button
                        id="restart-button"
                        class="py-3 px-6 bg-blue-500 text-white font-bold rounded-lg shadow-lg transition duration-300 hover:bg-blue-600 text-lg"
                    >
                        Làm lại bài thi
                    </button>
                </div>
            `;
        }

        function setupEndScreenListeners() {
            document.getElementById('restart-button')?.addEventListener('click', handleRestartQuiz);
        }

        // --- Question Type Renderers ---

        function renderMultipleChoiceQuestion(question, index) {
            let optionsHtml = question.options.map((option, i) => {
                const isSelected = submittedAnswer === option.text;
                let labelClasses = "block p-4 border-2 border-gray-200 rounded-lg shadow-sm text-lg transition duration-200";

                if (isAnswered) {
                    labelClasses += " cursor-default";
                    if (option.isCorrect) {
                        labelClasses += " bg-green-100 border-green-500 font-bold";
                    } else if (isSelected) {
                        labelClasses += " bg-red-100 border-red-500 font-bold";
                    } else {
                        labelClasses += " text-gray-400";
                    }
                } else {
                    labelClasses += " cursor-pointer hover:bg-blue-50 hover:border-blue-300";
                    if(isSelected) {
                        labelClasses += " bg-blue-100 border-blue-500";
                    }
                }
                
                return `
                    <div class="relative">
                        <label 
                            class="${labelClasses} mc-option" 
                            data-text="${option.text}" 
                            data-index="${i}" 
                            data-correct="${option.isCorrect}"
                            ${isAnswered ? 'style="pointer-events: none;"' : ''}
                        >
                            <span class="font-mono mr-2 font-bold text-gray-500">${String.fromCharCode(65 + i)}.</span>
                            ${option.text}
                        </label>
                    </div>
                `;
            }).join('');

            return `
                <h3 class="text-xl sm:text-2xl font-semibold mb-6 leading-relaxed">
                    ${index + 1}. ${question.question}
                </h3>
                <div class="space-y-3">
                    ${optionsHtml}
                </div>
                <button
                    id="submit-mc"
                    ${isAnswered ? 'disabled' : ''}
                    class="w-full py-2 px-4 bg-green-600 text-white font-semibold rounded-lg shadow-md transition duration-300 hover:bg-green-700 mt-4 disabled:bg-gray-400 disabled:cursor-not-allowed"
                >
                    Kiểm Tra Câu Trả Lời
                </button>
            `;
        }
        
        function setupMultipleChoiceListeners(question) {
            const submitButton = document.getElementById('submit-mc');
            const options = document.querySelectorAll('.mc-option');
            let selectedOption = null;

            options.forEach(option => {
                if (!isAnswered) {
                    option.addEventListener('click', function() {
                        options.forEach(o => o.classList.remove('bg-blue-100', 'border-blue-500'));
                        this.classList.add('bg-blue-100', 'border-blue-500');
                        selectedOption = {
                            text: this.dataset.text,
                            isCorrect: this.dataset.correct === 'true'
                        };
                    });
                }
            });

            submitButton?.addEventListener('click', () => {
                if (!selectedOption) {
                    showMessage('Vui lòng chọn một đáp án trước khi kiểm tra!', 'info');
                    return;
                }
                handleSubmit(selectedOption.text, selectedOption.isCorrect);
            });
        }


        function renderFillInTheBlankQuestion(question, index) {
            const placeholder = '____';
            let beforeText = question.question;
            let afterText = '';

            const formMatch = question.question.match(/([^_]*)____ \(([^)]+)\)\.?/);
            if (formMatch) {
                beforeText = formMatch[1].trim();
                afterText = `( ${formMatch[2].trim()} )`;
            } else if (question.question.includes(placeholder)) {
                const parts = question.question.split(placeholder);
                beforeText = parts[0].trim();
                afterText = parts[1] ? parts[1].trim() : '';
            }

            let inputClasses = 'inline-block mx-2 p-2 border-2 rounded-lg text-lg text-center shadow-sm transition duration-200 align-baseline w-32 sm:w-48';
            if (isAnswered) {
                const isSubmissionCorrect = submittedAnswer.toLowerCase() === question.correctAnswer.toLowerCase();
                inputClasses += isSubmissionCorrect ? ' border-green-500 bg-green-50' : ' border-red-500 bg-red-50';
            } else {
                inputClasses += ' border-gray-300 focus:border-blue-500';
            }

            return `
                <div class="space-y-4">
                    <div class="text-xl sm:text-2xl font-semibold mb-6 leading-relaxed flex justify-center items-center flex-wrap text-center">
                        <span>${index + 1}. </span>
                        ${beforeText && `<span class="ml-1">${beforeText}</span>`}
                        <input
                            type="text"
                            id="fill-in-input"
                            value="${isAnswered ? submittedAnswer : ''}"
                            ${isAnswered ? 'disabled' : ''}
                            placeholder="Điền từ"
                            class="${inputClasses}"
                            aria-label="Fill in the blank"
                        />
                        ${afterText && `<span>${afterText}</span>`}
                    </div>
                    <button
                        id="submit-fill"
                        ${isAnswered ? 'disabled' : ''}
                        class="w-full py-2 px-4 bg-green-600 text-white font-semibold rounded-lg shadow-md transition duration-300 hover:bg-green-700 mt-4 disabled:bg-gray-400 disabled:cursor-not-allowed"
                    >
                        Kiểm Tra Câu Trả Lời
                    </button>
                </div>
            `;
        }

        function setupFillInTheBlankListeners(question) {
            const inputElement = document.getElementById('fill-in-input');
            const submitButton = document.getElementById('submit-fill');

            const submitHandler = () => {
                const trimmedInput = inputElement.value.trim().replace(/\s+/g, ' ');
                if (trimmedInput === '') {
                    showMessage('Vui lòng điền câu trả lời của bạn!', 'info');
                    return;
                }
                const isCorrect = trimmedInput.toLowerCase() === question.correctAnswer.toLowerCase();
                handleSubmit(trimmedInput, isCorrect);
            };

            submitButton?.addEventListener('click', submitHandler);
            inputElement?.addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && !isAnswered) {
                    submitHandler();
                }
            });

            if (isAnswered) {
                inputElement.value = submittedAnswer;
            }
        }
        
        /**
         * Tạo HTML cho một Word Block (dùng chung cho cả sentence và source)
         */
        function createWordBlockHtml(word, isSource, isAnswered, action) {
            const baseClasses = 'word-block px-3 py-2 font-semibold rounded-lg shadow-sm transition-all duration-150 break-words';
            const sourceClasses = isSource ? 'bg-blue-100 text-blue-800 hover:bg-blue-200' : 'bg-gray-100 text-gray-800';
            const disabledClasses = isAnswered ? 'disabled' : '';
            
            return `
                <span 
                    class="${baseClasses} ${sourceClasses} ${disabledClasses}"
                    data-id="${word.id}" 
                    data-text="${word.text}"
                    data-action="${action}"
                >
                    ${word.text}
                </span>
            `;
        }

        /**
         * Cập nhật DOM cục bộ cho các khối từ (Rearrange Question)
         */
        function updateRearrangeUI(sentenceWords, sourceWords, isAnswered) {
            const sentenceArea = document.getElementById('sentence-area');
            const sourceBank = document.getElementById('source-bank');

            if (!sentenceArea || !sourceBank) return;

            // 1. Cập nhật Sentence Area
            if (sentenceWords.length === 0 && !isAnswered) {
                sentenceArea.innerHTML = `<span class="text-gray-500 italic text-sm">Xây dựng câu trả lời tại đây...</span>`;
            } else {
                const sentenceHtml = sentenceWords.map(word => 
                    createWordBlockHtml(word, false, isAnswered, 'return')
                ).join('');
                sentenceArea.innerHTML = sentenceHtml;
            }

            // 2. Cập nhật Source Bank
            const sourceHtml = sourceWords.map(word => 
                createWordBlockHtml(word, true, isAnswered, 'select')
            ).join('');
            sourceBank.innerHTML = sourceHtml;
        }

        function renderRearrangeQuestion(question, index) {
            let sentenceWords = [];
            let sourceWords = [...question.words];
            
            if (isAnswered) {
                sentenceWords = submittedAnswer.split(' ').map((text, id) => ({ id: Date.now() + id, text }));
                sourceWords = [];
            } else {
                const storedState = JSON.parse(sessionStorage.getItem('rearrangeState')) || {};
                
                if (storedState.questionIndex === index && storedState.words) {
                    sentenceWords = storedState.words.sentence;
                    sourceWords = storedState.words.source;
                } else {
                    const initialWords = question.words.map((text, id) => ({ id: Date.now() + id, text }));
                    sourceWords = shuffleArray(initialWords);
                    
                    sessionStorage.setItem('rearrangeState', JSON.stringify({
                        questionIndex: index,
                        words: { sentence: [], source: sourceWords }
                    }));
                }
            }

            const initialSentenceHtml = sentenceWords.length === 0 && !isAnswered ? 
                `<span class="text-gray-500 italic text-sm">Xây dựng câu trả lời tại đây...</span>` :
                sentenceWords.map(word => createWordBlockHtml(word, false, isAnswered, 'return')).join('');

            const initialSourceHtml = sourceWords.map(word => createWordBlockHtml(word, true, isAnswered, 'select')).join('');

            return `
                <h3 class="text-xl sm:text-2xl font-semibold mb-6 leading-relaxed">
                    ${index + 1}. ${question.question}
                </h3>
                <div class="space-y-4">
                    <div id="sentence-area" class="min-h-[60px] p-3 border-2 border-dashed border-blue-300 rounded-lg bg-blue-50 shadow-inner flex flex-wrap gap-2 items-center">
                        ${initialSentenceHtml}
                    </div>
                    <div id="source-bank" class="min-h-[100px] p-4 bg-gray-100 rounded-lg shadow-md flex flex-wrap gap-2 items-center border border-gray-200">
                        ${initialSourceHtml}
                    </div>
                    <button
                        id="submit-rearrange"
                        ${isAnswered ? 'disabled' : ''}
                        class="w-full py-2 px-4 bg-green-600 text-white font-semibold rounded-lg shadow-md transition duration-300 hover:bg-green-700 mt-4 disabled:bg-gray-400 disabled:cursor-not-allowed"
                    >
                        Kiểm Tra Câu Trả Lời
                    </button>
                </div>
            `;
        }

        function setupRearrangeListeners(question) {
            if (isAnswered) return;

            let state = JSON.parse(sessionStorage.getItem('rearrangeState'));
            if (!state || state.questionIndex !== currentQuestionIndex) {
                return;
            }

            let sentenceWords = state.words.sentence;
            let sourceWords = state.words.source;
            
            const submitButton = document.getElementById('submit-rearrange');

            const saveStateAndRefreshUI = () => {
                 sessionStorage.setItem('rearrangeState', JSON.stringify({
                    questionIndex: currentQuestionIndex,
                    words: { sentence: sentenceWords, source: sourceWords }
                }));
                updateRearrangeUI(sentenceWords, sourceWords, isAnswered);
            };

            // Listener chung cho cả hai khu vực
            document.getElementById('question-container').addEventListener('click', (e) => {
                if (isAnswered) return;
                
                const target = e.target.closest('.word-block');
                if (!target) return;

                const action = target.dataset.action;
                const id = parseInt(target.dataset.id);

                if (action === 'select') {
                    const wordIndex = sourceWords.findIndex(w => w.id === id);
                    if (wordIndex !== -1) {
                        const word = sourceWords.splice(wordIndex, 1)[0];
                        sentenceWords.push(word);
                        saveStateAndRefreshUI();
                    }
                } else if (action === 'return') {
                    const wordIndex = sentenceWords.findIndex(w => w.id === id);
                    if (wordIndex !== -1) {
                        const word = sentenceWords.splice(wordIndex, 1)[0];
                        sourceWords.push(word);
                        sourceWords.sort((a, b) => a.id - b.id);
                        saveStateAndRefreshUI();
                    }
                }
            });
            
            // Submission logic
            submitButton?.addEventListener('click', () => {
                if (sentenceWords.length === 0) {
                    showMessage('Vui lòng sắp xếp các từ trước khi kiểm tra!', 'info');
                    return;
                }
                
                const submitted = sentenceWords.map(w => w.text).join(' ').replace(/\s+([.,?!])/g, '$1').trim();
                
                const normalize = (str) => str.replace(/[.,?!]/g, '').replace(/\s+/g, ' ').toLowerCase().trim();
                const submittedNormalized = normalize(submitted);
                const correctNormalized = normalize(question.correctAnswer);
                
                const isCorrect = submittedNormalized === correctNormalized;

                sessionStorage.removeItem('rearrangeState');

                handleSubmit(submitted, isCorrect);
            });
        }

        // --- Main Render Logic ---

        function renderQuizScreen() {
            if (shuffledQuestions.length === 0) {
                return `<div class="text-center p-8">Đang tải câu hỏi...</div>`;
            }

            const currentQuestion = shuffledQuestions[currentQuestionIndex];
            const progressPercentage = ((currentQuestionIndex + 1) / shuffledQuestions.length) * 100;
            
            let questionHtml = '';
            let setupListeners = () => {};

            switch (currentQuestion.type) {
                case 'rearrange':
                    questionHtml = renderRearrangeQuestion(currentQuestion, currentQuestionIndex);
                    setupListeners = () => setupRearrangeListeners(currentQuestion);
                    break;
                case 'mc':
                    questionHtml = renderMultipleChoiceQuestion(currentQuestion, currentQuestionIndex);
                    setupListeners = () => setupMultipleChoiceListeners(currentQuestion);
                    break;
                case 'fill-in-the-blank':
                    questionHtml = renderFillInTheBlankQuestion(currentQuestion, currentQuestionIndex);
                    setupListeners = () => setupFillInTheBlankListeners(currentQuestion);
                    break;
                default:
                    questionHtml = `<p>Không xác định loại câu hỏi.</p>`;
            }
            
            const hintHtml = (currentQuestion.hint_vi || currentQuestion.hint_en) ? `
                <div class="relative inline-block" id="hint-container">
                    <button
                        id="hint-button"
                        class="bg-yellow-500 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 hover:bg-yellow-600 active:scale-95"
                    >
                        Giữ để xem Gợi ý
                    </button>
                    <div id="hint-box" class="absolute bottom-full mb-2 w-max max-w-sm p-4 bg-yellow-100 border-l-4 border-yellow-500 rounded-lg transition-opacity duration-300 opacity-0 pointer-events-none">
                        <p class="font-semibold text-yellow-800">Gợi ý (Hint):</p>
                        <p class="text-yellow-700">${currentQuestion.hint_vi || currentQuestion.hint_en}</p>
                    </div>
                </div>
            ` : '';


            return `
                <div class="fade-in">
                    <header class="text-center mb-8">
                        <h1 class="text-3xl sm:text-4xl font-extrabold text-blue-600 mb-2">Bài Thi Thử IOE Lớp 8</h1>
                        <p class="text-lg text-gray-500">Sắp xếp câu, Điền từ & Trắc nghiệm Tiếng Anh</p>
                        ${renderProgressBar(progressPercentage)}
                    </header>

                    <div class="flex justify-between items-center mb-6 py-2 px-4 bg-blue-50 rounded-lg shadow-inner">
                        <p class="text-sm sm:text-base font-medium text-blue-800">Người chơi: <span class="font-bold">${playerName}</span></p>
                        <p class="text-sm sm:text-base font-medium text-blue-800">Điểm: <span class="text-xl font-extrabold text-red-600">${score}</span></p>
                        <p class="text-sm sm:text-base font-medium text-blue-800">Tiến độ: <span class="font-bold">${currentQuestionIndex + 1}/${shuffledQuestions.length}</span></p>
                    </div>

                    <div class="mb-8" id="question-container">
                        ${questionHtml}
                    </div>

                    <div class="mt-8 border-t pt-6">
                        ${hintHtml}
                    </div>

                    ${isAnswered ? renderRationaleBox(currentQuestion, isCorrect, submittedAnswer) : ''}

                    <button 
                        id="next-button"
                        ${!isAnswered ? 'disabled' : ''}
                        class="w-full py-3 px-4 bg-blue-500 text-white font-bold rounded-lg shadow-xl transition duration-300 hover:bg-blue-600 mt-8 disabled:bg-gray-400 disabled:cursor-not-allowed"
                    >
                        ${currentQuestionIndex === shuffledQuestions.length - 1 ? 'Hoàn thành' : 'Tiếp Theo »'}
                    </button>
                </div>
            `;
        }

        function setupQuizScreenListeners() {
            const nextButton = document.getElementById('next-button');
            nextButton?.addEventListener('click', handleNext);

            // Hint logic
            const hintButton = document.getElementById('hint-button');
            const hintBox = document.getElementById('hint-box');
            if (hintButton && hintBox) {
                const showHint = () => {
                    hintBox.classList.remove('opacity-0', 'pointer-events-none');
                    hintBox.classList.add('opacity-100');
                };
                const hideHint = () => {
                    hintBox.classList.remove('opacity-100');
                    hintBox.classList.add('opacity-0', 'pointer-events-none');
                };
                
                hintButton.addEventListener('mouseenter', showHint);
                hintButton.addEventListener('mouseleave', hideHint);
                hintButton.addEventListener('touchstart', showHint);
                hintButton.addEventListener('touchend', hideHint);
            }

            // Setup question specific listeners
            const currentQuestion = shuffledQuestions[currentQuestionIndex];
            switch (currentQuestion.type) {
                case 'mc':
                    setupMultipleChoiceListeners(currentQuestion);
                    break;
                case 'fill-in-the-blank':
                    setupFillInTheBlankListeners(currentQuestion);
                    break;
                case 'rearrange':
                    setupRearrangeListeners(currentQuestion);
                    break;
            }
        }

        // --- Main App Renderer ---

        function renderApp() {
            let contentHtml = '';
            let setupListeners = () => {};

            switch (gameState) {
                case 'start':
                    contentHtml = renderStartScreen();
                    setupListeners = setupStartScreenListeners;
                    sessionStorage.removeItem('rearrangeState'); 
                    clearMessageBox();
                    break;
                case 'quiz':
                    contentHtml = renderQuizScreen();
                    setupListeners = setupQuizScreenListeners;
                    break;
                case 'end':
                    contentHtml = renderEndScreen();
                    setupListeners = setupEndScreenListeners;
                    clearMessageBox();
                    break;
            }

            appRoot.innerHTML = contentHtml;
            setupListeners();
            renderMessageBox();
        }

        // --- Initial Load ---
        window.onload = function() {
            if (shuffledQuestions.length === 0) {
                 shuffledQuestions = shuffleArray(questions);
            }
            renderApp();
        };

    </script>
</body>
</html>
